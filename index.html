<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#d32323">
    <meta name="description" content="Find nearby restaurants based on your favorite foods">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Food Finder">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <title>Food Finder - Find Nearby Restaurants</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #d32323;
            --primary-dark: #af1c1c;
            --primary-light: #ff4d4d;
            --secondary: #0073bb;
            --bg-white: #ffffff;
            --bg-light: #f5f5f5;
            --bg-card: #ffffff;
            --text-dark: #1a1a1a;
            --text-medium: #666666;
            --text-light: #999999;
            --border: #e6e6e6;
            --star: #ff8c00;
            --success: #41a700;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.12);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.16);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 20px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-light);
            color: var(--text-dark);
            min-height: 100vh;
            line-height: 1.5;
        }

        #root {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-light); }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #aaa; }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            padding: 20px 24px;
            color: white;
            box-shadow: var(--shadow-md);
            position: relative;
            z-index: 100;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            font-size: 36px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));
        }

        .logo h1 {
            font-size: 28px;
            font-weight: 800;
            letter-spacing: -0.5px;
        }

        .location-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.2);
            padding: 8px 16px;
            border-radius: 50px;
            font-size: 14px;
            backdrop-filter: blur(10px);
        }

        .location-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4ade80;
            animation: pulse 2s infinite;
        }

        .location-dot.error { background: #ff6b6b; animation: none; }
        .location-dot.loading { background: #fbbf24; }

        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
        }

        /* Main Layout */
        .main-content {
            flex: 1;
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            padding: 24px;
            gap: 24px;
        }

        /* Left Panel - Foods */
        .foods-panel {
            width: 320px;
            min-width: 320px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .panel-card {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
        }

        .panel-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: white;
        }

        .panel-title {
            font-size: 18px;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .panel-subtitle {
            font-size: 13px;
            opacity: 0.9;
        }

        .add-food-form {
            padding: 16px;
            display: flex;
            gap: 10px;
            border-bottom: 1px solid var(--border);
        }

        .add-food-input {
            flex: 1;
            border: 2px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 12px 16px;
            font-size: 15px;
            font-family: inherit;
            transition: all 0.2s;
        }

        .add-food-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(211, 35, 35, 0.1);
        }

        .add-food-btn {
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            padding: 12px 20px;
            font-size: 15px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s;
        }

        .add-food-btn:hover { background: var(--primary-dark); transform: translateY(-1px); }
        .add-food-btn:active { transform: translateY(0); }
        .add-food-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

        .foods-list {
            padding: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .food-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px;
            background: var(--bg-light);
            border-radius: var(--radius-sm);
            margin-bottom: 10px;
            cursor: grab;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .food-item:hover {
            border-color: var(--primary);
            box-shadow: var(--shadow-sm);
        }

        .food-item.dragging { opacity: 0.5; }
        .food-item.drag-over { border-color: var(--secondary); background: #e3f2fd; }

        .food-priority {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: 700;
        }

        .food-name {
            flex: 1;
            font-size: 15px;
            font-weight: 500;
            color: var(--text-dark);
        }

        .food-delete {
            width: 28px;
            height: 28px;
            background: none;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.2s;
        }

        .food-delete:hover {
            background: #fee2e2;
            color: var(--primary);
        }

        .empty-foods {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-medium);
        }

        .empty-foods-icon { font-size: 56px; margin-bottom: 12px; }

        /* Controls Card */
        .controls-card {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            padding: 20px;
        }

        .controls-row {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            align-items: center;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .control-label {
            font-size: 12px;
            font-weight: 600;
            color: var(--text-medium);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .distance-buttons {
            display: flex;
            background: var(--bg-light);
            border-radius: var(--radius-sm);
            padding: 4px;
        }

        .distance-btn {
            background: none;
            border: none;
            padding: 10px 14px;
            font-size: 14px;
            font-weight: 500;
            font-family: inherit;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            color: var(--text-medium);
        }

        .distance-btn.active {
            background: var(--primary);
            color: white;
            box-shadow: var(--shadow-sm);
        }

        .distance-btn:hover:not(.active) { background: #e0e0e0; }

        .toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle {
            position: relative;
            width: 50px;
            height: 28px;
            cursor: pointer;
        }

        .toggle input { display: none; }

        .toggle-track {
            position: absolute;
            inset: 0;
            background: #ccc;
            border-radius: 14px;
            transition: all 0.2s;
        }

        .toggle input:checked + .toggle-track { background: var(--success); }

        .toggle-thumb {
            position: absolute;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            top: 3px;
            left: 3px;
            transition: all 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .toggle input:checked ~ .toggle-thumb { transform: translateX(22px); }

        .toggle-label {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-dark);
        }

        .search-btn {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            padding: 14px 28px;
            font-size: 16px;
            font-weight: 700;
            font-family: inherit;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow-sm);
            margin-left: auto;
        }

        .search-btn:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
        .search-btn:active { transform: translateY(0); }
        .search-btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

        /* Results Panel */
        .results-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 0;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .results-title {
            font-size: 22px;
            font-weight: 700;
            color: var(--text-dark);
        }

        .results-count {
            font-size: 14px;
            color: var(--text-medium);
            background: var(--bg-light);
            padding: 6px 14px;
            border-radius: 50px;
        }

        .map-results-container {
            display: flex;
            gap: 20px;
            flex: 1;
            min-height: 500px;
        }

        /* Map */
        .map-container {
            flex: 1;
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-md);
            position: relative;
            min-height: 400px;
        }

        #map { width: 100%; height: 100%; }

        .map-placeholder {
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8eb 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-medium);
        }

        .map-placeholder-icon { font-size: 72px; margin-bottom: 16px; }

        .loading-overlay {
            position: absolute;
            inset: 0;
            background: rgba(255,255,255,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 16px;
        }

        .loading-spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* Restaurant List */
        .restaurants-list {
            width: 420px;
            min-width: 420px;
            max-height: 700px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding-right: 8px;
        }

        .restaurant-card {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }

        .restaurant-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }

        .restaurant-card.selected {
            border-color: var(--primary);
            box-shadow: var(--shadow-lg);
        }

        .restaurant-content {
            padding: 20px;
        }

        .restaurant-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .restaurant-name {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-dark);
            line-height: 1.3;
        }

        .restaurant-distance {
            background: linear-gradient(135deg, var(--secondary) 0%, #00a0dc 100%);
            color: white;
            padding: 6px 12px;
            border-radius: 50px;
            font-size: 13px;
            font-weight: 600;
            white-space: nowrap;
            margin-left: 12px;
        }

        .restaurant-rating {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 10px;
        }

        .stars {
            display: flex;
            gap: 2px;
        }

        .star { font-size: 18px; color: var(--star); }
        .star.empty { color: #ddd; }

        .rating-text {
            font-size: 14px;
            color: var(--text-medium);
        }

        .rating-number {
            font-weight: 700;
            color: var(--text-dark);
        }

        .restaurant-meta {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
            margin-bottom: 12px;
        }

        .meta-item {
            font-size: 14px;
            color: var(--text-medium);
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .meta-item.open { color: var(--success); font-weight: 600; }
        .meta-item.closed { color: var(--primary); font-weight: 600; }

        .price-tag {
            font-weight: 600;
            color: var(--success);
        }

        .matched-foods {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 16px;
        }

        .food-tag {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #b7472a;
            padding: 6px 12px;
            border-radius: 50px;
            font-size: 12px;
            font-weight: 600;
        }

        .restaurant-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            padding-top: 16px;
            border-top: 1px solid var(--border);
        }

        .action-btn {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 10px 16px;
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-weight: 600;
            font-family: inherit;
            text-decoration: none;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
        }

        .action-btn.primary {
            background: var(--primary);
            color: white;
        }

        .action-btn.primary:hover { background: var(--primary-dark); }

        .action-btn.secondary {
            background: var(--bg-light);
            color: var(--text-dark);
            border: 1px solid var(--border);
        }

        .action-btn.secondary:hover { background: #e8e8e8; }

        .action-btn.outline {
            background: transparent;
            color: var(--secondary);
            border: 2px solid var(--secondary);
        }

        .action-btn.outline:hover { background: var(--secondary); color: white; }

        .empty-results {
            text-align: center;
            padding: 60px 30px;
            background: var(--bg-card);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
        }

        .empty-results-icon { font-size: 80px; margin-bottom: 20px; }
        .empty-results h3 { font-size: 20px; margin-bottom: 10px; color: var(--text-dark); }
        .empty-results p { color: var(--text-medium); }

        /* Footer */
        .footer {
            background: var(--text-dark);
            color: white;
            padding: 16px 24px;
            text-align: center;
            font-size: 14px;
        }

        .footer a { color: var(--primary-light); }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-content { flex-direction: column; }
            .foods-panel { width: 100%; min-width: 100%; flex-direction: row; gap: 20px; }
            .foods-panel > * { flex: 1; }
            .restaurants-list { width: 100%; min-width: 100%; max-height: none; }
            .map-results-container { flex-direction: column; }
        }

        @media (max-width: 768px) {
            .header { padding: 16px; }
            .logo h1 { font-size: 22px; }
            .main-content { padding: 16px; }
            .foods-panel { flex-direction: column; }
            .controls-row { flex-direction: column; align-items: stretch; }
            .search-btn { margin-left: 0; width: 100%; justify-content: center; }
            .restaurant-actions { flex-direction: column; }
            .action-btn { justify-content: center; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Constants
        const GOOGLE_API_KEY = 'AIzaSyDeTlwdCU0nEO9QTCN5vXzMuDMuhiIrnSU';
        const STORAGE_KEYS = { FAVORITES: 'foodfinder_favorite_foods' };
        const DISTANCE_OPTIONS = [5, 10, 15, 25];
        const MILES_TO_METERS = 1609.34;

        // Utility Functions
        const generateId = () => Math.random().toString(36).substr(2, 9);

        const calculateDistance = (lat1, lng1, lat2, lng2) => {
            const R = 3959;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLng / 2) * Math.sin(dLng / 2);
            return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        };

        const formatDistance = (miles) => miles < 0.1 ? '< 0.1 mi' : `${miles.toFixed(1)} mi`;

        const getPriceLevel = (level) => {
            if (level === undefined || level === null) return null;
            return '$'.repeat(level + 1);
        };

        // Food Item Component
        const FoodItem = ({ food, index, onDelete, onDragStart, onDragOver, onDrop, isDragging, isDragOver }) => (
            <div
                className={`food-item ${isDragging ? 'dragging' : ''} ${isDragOver ? 'drag-over' : ''}`}
                draggable
                onDragStart={(e) => onDragStart(e, index)}
                onDragOver={(e) => onDragOver(e, index)}
                onDrop={(e) => onDrop(e, index)}
            >
                <div className="food-priority">{index + 1}</div>
                <span className="food-name">{food.name}</span>
                <button className="food-delete" onClick={() => onDelete(food.id)}>√ó</button>
            </div>
        );

        // Foods Panel Component
        const FoodsPanel = ({ foods, onAddFood, onDeleteFood, onReorderFoods }) => {
            const [newFood, setNewFood] = useState('');
            const [dragIndex, setDragIndex] = useState(null);
            const [dragOverIndex, setDragOverIndex] = useState(null);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (newFood.trim()) {
                    onAddFood(newFood.trim());
                    setNewFood('');
                }
            };

            return (
                <div className="panel-card">
                    <div className="panel-header">
                        <div className="panel-title">What are you craving?</div>
                        <div className="panel-subtitle">Add foods to find matching restaurants</div>
                    </div>
                    <form className="add-food-form" onSubmit={handleSubmit}>
                        <input
                            type="text"
                            className="add-food-input"
                            placeholder="Pizza, Tacos, Sushi..."
                            value={newFood}
                            onChange={(e) => setNewFood(e.target.value)}
                        />
                        <button type="submit" className="add-food-btn" disabled={!newFood.trim()}>Add</button>
                    </form>
                    <div className="foods-list">
                        {foods.length === 0 ? (
                            <div className="empty-foods">
                                <div className="empty-foods-icon">üçï</div>
                                <p>Add your favorite foods to get started!</p>
                            </div>
                        ) : (
                            foods.map((food, index) => (
                                <FoodItem
                                    key={food.id}
                                    food={food}
                                    index={index}
                                    onDelete={onDeleteFood}
                                    onDragStart={(e, i) => setDragIndex(i)}
                                    onDragOver={(e, i) => { e.preventDefault(); setDragOverIndex(i); }}
                                    onDrop={(e, i) => {
                                        e.preventDefault();
                                        if (dragIndex !== null && dragIndex !== i) onReorderFoods(dragIndex, i);
                                        setDragIndex(null);
                                        setDragOverIndex(null);
                                    }}
                                    isDragging={dragIndex === index}
                                    isDragOver={dragOverIndex === index}
                                />
                            ))
                        )}
                    </div>
                </div>
            );
        };

        // Star Rating Component
        const StarRating = ({ rating }) => {
            const stars = [];
            for (let i = 0; i < 5; i++) {
                stars.push(
                    <span key={i} className={`star ${i < Math.round(rating) ? '' : 'empty'}`}>‚òÖ</span>
                );
            }
            return <div className="stars">{stars}</div>;
        };

        // Restaurant Card Component
        const RestaurantCard = ({ restaurant, isSelected, onClick, userLocation }) => {
            const directionsUrl = `https://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(restaurant.name)}&destination_place_id=${restaurant.placeId}`;
            const googleSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(restaurant.name + ' ' + (restaurant.address || ''))}`;
            const menuSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(restaurant.name + ' menu')}`;
            const yelpSearchUrl = `https://www.yelp.com/search?find_desc=${encodeURIComponent(restaurant.name)}&find_loc=${encodeURIComponent(restaurant.address || '')}`;

            return (
                <div className={`restaurant-card ${isSelected ? 'selected' : ''}`} onClick={onClick}>
                    <div className="restaurant-content">
                        <div className="restaurant-header">
                            <div className="restaurant-name">{restaurant.name}</div>
                            <div className="restaurant-distance">{formatDistance(restaurant.distance)}</div>
                        </div>

                        <div className="restaurant-rating">
                            <StarRating rating={restaurant.rating || 0} />
                            <span className="rating-text">
                                <span className="rating-number">{restaurant.rating?.toFixed(1) || 'N/A'}</span>
                                {' '}({restaurant.reviewCount || 0} reviews)
                            </span>
                        </div>

                        <div className="restaurant-meta">
                            {getPriceLevel(restaurant.priceLevel) && (
                                <span className="meta-item">
                                    <span className="price-tag">{getPriceLevel(restaurant.priceLevel)}</span>
                                </span>
                            )}
                            {restaurant.isOpen !== undefined && (
                                <span className={`meta-item ${restaurant.isOpen ? 'open' : 'closed'}`}>
                                    {restaurant.isOpen ? '‚óè Open Now' : '‚óè Closed'}
                                </span>
                            )}
                            {restaurant.address && (
                                <span className="meta-item">üìç {restaurant.address}</span>
                            )}
                        </div>

                        {restaurant.matchedFoods?.length > 0 && (
                            <div className="matched-foods">
                                {restaurant.matchedFoods.map((food, i) => (
                                    <span key={i} className="food-tag">{food}</span>
                                ))}
                            </div>
                        )}

                        <div className="restaurant-actions">
                            <a href={yelpSearchUrl} target="_blank" rel="noopener noreferrer" className="action-btn primary" onClick={(e) => e.stopPropagation()}>
                                View on Yelp
                            </a>
                            <a href={menuSearchUrl} target="_blank" rel="noopener noreferrer" className="action-btn secondary" onClick={(e) => e.stopPropagation()}>
                                üçΩÔ∏è Menu
                            </a>
                            <a href={directionsUrl} target="_blank" rel="noopener noreferrer" className="action-btn outline" onClick={(e) => e.stopPropagation()}>
                                üìç Directions
                            </a>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App Component
        const App = () => {
            const [apiReady, setApiReady] = useState(false);
            const [foods, setFoods] = useState(() => {
                const saved = localStorage.getItem(STORAGE_KEYS.FAVORITES);
                return saved ? JSON.parse(saved) : [];
            });
            const [userLocation, setUserLocation] = useState(null);
            const [locationError, setLocationError] = useState('');
            const [locationLoading, setLocationLoading] = useState(true);
            const [distance, setDistance] = useState(10);
            const [openOnly, setOpenOnly] = useState(false);
            const [restaurants, setRestaurants] = useState([]);
            const [selectedRestaurant, setSelectedRestaurant] = useState(null);
            const [searchLoading, setSearchLoading] = useState(false);

            const mapRef = useRef(null);
            const mapInstanceRef = useRef(null);
            const markersRef = useRef([]);
            const placesServiceRef = useRef(null);

            useEffect(() => {
                localStorage.setItem(STORAGE_KEYS.FAVORITES, JSON.stringify(foods));
            }, [foods]);

            useEffect(() => {
                if (window.google?.maps) { setApiReady(true); return; }
                const script = document.createElement('script');
                script.src = `https://maps.googleapis.com/maps/api/js?key=${GOOGLE_API_KEY}&libraries=places`;
                script.async = true;
                script.onload = () => setApiReady(true);
                document.head.appendChild(script);
            }, []);

            useEffect(() => {
                if (!navigator.geolocation) {
                    setLocationError('Geolocation not supported');
                    setLocationLoading(false);
                    return;
                }
                navigator.geolocation.getCurrentPosition(
                    (pos) => {
                        setUserLocation({ lat: pos.coords.latitude, lng: pos.coords.longitude });
                        setLocationLoading(false);
                    },
                    () => {
                        setLocationError('Location access denied');
                        setLocationLoading(false);
                    },
                    { enableHighAccuracy: true, timeout: 10000 }
                );
            }, []);

            useEffect(() => {
                if (!apiReady || !userLocation || !mapRef.current || mapInstanceRef.current) return;

                const map = new google.maps.Map(mapRef.current, {
                    center: userLocation,
                    zoom: 13,
                    styles: [
                        { featureType: 'poi', elementType: 'labels', stylers: [{ visibility: 'off' }] },
                        { featureType: 'transit', stylers: [{ visibility: 'off' }] }
                    ],
                    mapTypeControl: false,
                    fullscreenControl: false
                });

                mapInstanceRef.current = map;
                placesServiceRef.current = new google.maps.places.PlacesService(map);

                new google.maps.Marker({
                    position: userLocation,
                    map,
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: 12,
                        fillColor: '#d32323',
                        fillOpacity: 1,
                        strokeColor: '#fff',
                        strokeWeight: 3
                    },
                    title: 'You'
                });
            }, [apiReady, userLocation]);

            const addFood = (name) => {
                if (foods.find(f => f.name.toLowerCase() === name.toLowerCase())) return;
                setFoods(prev => [...prev, { id: generateId(), name }]);
            };

            const deleteFood = (id) => setFoods(prev => prev.filter(f => f.id !== id));

            const reorderFoods = (from, to) => {
                setFoods(prev => {
                    const arr = [...prev];
                    const [moved] = arr.splice(from, 1);
                    arr.splice(to, 0, moved);
                    return arr;
                });
            };

            const searchRestaurants = async () => {
                if (!placesServiceRef.current || !userLocation || !foods.length) return;

                setSearchLoading(true);
                setRestaurants([]);
                markersRef.current.forEach(m => m.setMap(null));
                markersRef.current = [];

                const allResults = new Map();

                await Promise.all(foods.map(food =>
                    new Promise(resolve => {
                        placesServiceRef.current.nearbySearch({
                            location: userLocation,
                            radius: distance * MILES_TO_METERS,
                            type: 'restaurant',
                            keyword: food.name
                        }, (results, status) => {
                            if (status === google.maps.places.PlacesServiceStatus.OK && results) {
                                results.forEach(place => {
                                    const dist = calculateDistance(
                                        userLocation.lat, userLocation.lng,
                                        place.geometry.location.lat(), place.geometry.location.lng()
                                    );
                                    if (dist <= distance) {
                                        if (allResults.has(place.place_id)) {
                                            const existing = allResults.get(place.place_id);
                                            if (!existing.matchedFoods.includes(food.name)) {
                                                existing.matchedFoods.push(food.name);
                                            }
                                        } else {
                                            allResults.set(place.place_id, {
                                                placeId: place.place_id,
                                                name: place.name,
                                                rating: place.rating,
                                                reviewCount: place.user_ratings_total,
                                                distance: dist,
                                                priceLevel: place.price_level,
                                                location: { lat: place.geometry.location.lat(), lng: place.geometry.location.lng() },
                                                matchedFoods: [food.name],
                                                address: place.vicinity,
                                                isOpen: place.opening_hours?.isOpen?.()
                                            });
                                        }
                                    }
                                });
                            }
                            resolve();
                        });
                    })
                ));

                const sorted = Array.from(allResults.values()).sort((a, b) =>
                    a.distance !== b.distance ? a.distance - b.distance : (b.rating || 0) - (a.rating || 0)
                );

                setRestaurants(sorted);

                sorted.forEach((r, i) => {
                    const marker = new google.maps.Marker({
                        position: r.location,
                        map: mapInstanceRef.current,
                        label: { text: String(i + 1), color: '#fff', fontWeight: 'bold', fontSize: '12px' },
                        icon: {
                            path: google.maps.SymbolPath.CIRCLE,
                            scale: 18,
                            fillColor: '#d32323',
                            fillOpacity: 1,
                            strokeColor: '#fff',
                            strokeWeight: 2
                        }
                    });
                    marker.addListener('click', () => {
                        setSelectedRestaurant(r.placeId);
                        document.querySelector(`[data-place-id="${r.placeId}"]`)?.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    });
                    markersRef.current.push(marker);
                });

                if (sorted.length) {
                    const bounds = new google.maps.LatLngBounds();
                    bounds.extend(userLocation);
                    sorted.forEach(r => bounds.extend(r.location));
                    mapInstanceRef.current.fitBounds(bounds, 50);
                }

                setSearchLoading(false);
            };

            const handleCardClick = (placeId) => {
                setSelectedRestaurant(placeId);
                const r = restaurants.find(r => r.placeId === placeId);
                if (r && mapInstanceRef.current) {
                    mapInstanceRef.current.panTo(r.location);
                    mapInstanceRef.current.setZoom(16);
                }
            };

            const filteredRestaurants = openOnly ? restaurants.filter(r => r.isOpen) : restaurants;

            return (
                <div className="app-container">
                    <header className="header">
                        <div className="header-content">
                            <div className="logo">
                                <span className="logo-icon">üçî</span>
                                <h1>Food Finder</h1>
                            </div>
                            <div className="location-badge">
                                <div className={`location-dot ${locationError ? 'error' : ''} ${locationLoading ? 'loading' : ''}`} />
                                <span>
                                    {locationLoading ? 'Finding you...' :
                                     locationError ? locationError :
                                     'Location found'}
                                </span>
                            </div>
                        </div>
                    </header>

                    <main className="main-content">
                        <div className="foods-panel">
                            <FoodsPanel
                                foods={foods}
                                onAddFood={addFood}
                                onDeleteFood={deleteFood}
                                onReorderFoods={reorderFoods}
                            />

                            <div className="controls-card">
                                <div className="controls-row">
                                    <div className="control-group">
                                        <span className="control-label">Distance</span>
                                        <div className="distance-buttons">
                                            {DISTANCE_OPTIONS.map(d => (
                                                <button
                                                    key={d}
                                                    className={`distance-btn ${distance === d ? 'active' : ''}`}
                                                    onClick={() => setDistance(d)}
                                                >
                                                    {d} mi
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="control-group">
                                        <span className="control-label">Filter</span>
                                        <div className="toggle-container">
                                            <label className="toggle">
                                                <input type="checkbox" checked={openOnly} onChange={(e) => setOpenOnly(e.target.checked)} />
                                                <div className="toggle-track" />
                                                <div className="toggle-thumb" />
                                            </label>
                                            <span className="toggle-label">Open Now</span>
                                        </div>
                                    </div>

                                    <button
                                        className="search-btn"
                                        onClick={searchRestaurants}
                                        disabled={!userLocation || !foods.length || searchLoading}
                                    >
                                        {searchLoading ? 'Searching...' : 'üîç Find Food'}
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div className="results-panel">
                            <div className="results-header">
                                <h2 className="results-title">Nearby Restaurants</h2>
                                {filteredRestaurants.length > 0 && (
                                    <span className="results-count">
                                        {filteredRestaurants.length} found
                                        {openOnly && restaurants.length !== filteredRestaurants.length && ` of ${restaurants.length}`}
                                    </span>
                                )}
                            </div>

                            <div className="map-results-container">
                                <div className="map-container">
                                    {!userLocation ? (
                                        <div className="map-placeholder">
                                            <div className="map-placeholder-icon">üìç</div>
                                            <p>{locationLoading ? 'Getting your location...' : 'Enable location to see map'}</p>
                                        </div>
                                    ) : (
                                        <div id="map" ref={mapRef} />
                                    )}
                                    {searchLoading && (
                                        <div className="loading-overlay">
                                            <div className="loading-spinner" />
                                            <span>Finding delicious places...</span>
                                        </div>
                                    )}
                                </div>

                                <div className="restaurants-list">
                                    {filteredRestaurants.length === 0 ? (
                                        <div className="empty-results">
                                            <div className="empty-results-icon">üçΩÔ∏è</div>
                                            <h3>
                                                {foods.length === 0 ? 'Add some foods!' :
                                                 restaurants.length === 0 ? 'Ready to search' :
                                                 'No open restaurants'}
                                            </h3>
                                            <p>
                                                {foods.length === 0 ? 'Tell us what you\'re craving' :
                                                 restaurants.length === 0 ? 'Click "Find Food" to discover nearby spots' :
                                                 'Try turning off the "Open Now" filter'}
                                            </p>
                                        </div>
                                    ) : (
                                        filteredRestaurants.map(restaurant => (
                                            <div key={restaurant.placeId} data-place-id={restaurant.placeId}>
                                                <RestaurantCard
                                                    restaurant={restaurant}
                                                    isSelected={selectedRestaurant === restaurant.placeId}
                                                    onClick={() => handleCardClick(restaurant.placeId)}
                                                    userLocation={userLocation}
                                                />
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        </div>
                    </main>

                    <footer className="footer">
                        Made with ‚ù§Ô∏è | Food Finder
                    </footer>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);

        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js').catch(() => {});
            });
        }
    </script>
</body>
</html>
